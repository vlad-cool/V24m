#:kivy 2.1.0

Carousel:
    loop: True

    debug: "No debug data"

    weapon: 0
    weapon_connection_type: 0

    score_l_l: "0"
    score_l_r: " "
    score_r_l: " "
    score_r_r: "0"

    timer_0: "C"
    timer_1: ":"
    timer_2: "0"
    timer_3: "6"

    timer_text: ""

    timer_running: 0

    period: 1
    priority: 0
    warning_l: 0
    warning_r: 0

    passive_time: 0
    passive_size: 0
    passive_coun: "60"

    flash_timer: 0
    current_time: 0

    epee5: 0

    time_updated: True

    color_passive: [0, 0, 0, 1]
    color_timer: app.color_timer_orange
    color_invis: [0, 0, 0, 0]

    video_playing: False

    on_index: app.load_video_list()

    recording: False

    wired_ip: "No connection"
    wireless_ip: "No connection"

    FloatLayout:
        BoxLayout:
            id: weapon_selector
            orientation: "horizontal"
            size: 1000, 100
            size_hint: None, None
            pos: 460, 0

            ToggleButton:
                id: weapon_connection_type
                text: "wls"
                state: "down" if root.weapon_connection_type == 1 else "normal"
                font_size: 80
                font_name:"agencyb"
                color: app.color_weapon_dis if root.weapon != 1 else app.color_weapon_ena
                background_color: [0, 0, 0, 1]
                on_press: app.change_weapon_connection_type()

            ToggleButton:
                id: weapon_2
                text: "fleuret"
                state: "down" if root.weapon == 2 else "normal"
                font_size: 80
                font_name:"agencyb"
                group: "weapon"
                color: app.color_weapon_dis if root.weapon != 2 else app.color_weapon_ena
                background_color: [0, 0, 0, 1]
                on_press: app.set_weapon(2)

            ToggleButton:
                id: weapon_0
                markup: True
                text: "epee [color=4c4c4c]5[/color]" if root.epee5 == 0 else "epee 5"
                state: "down" if root.weapon == 3 else "normal"
                font_size: 80
                font_name:"agencyb"
                group: "weapon"
                color: app.color_weapon_dis if root.weapon != 3 else app.color_weapon_ena
                background_color: [0, 0, 0, 1]
                on_press: app.set_weapon(0)

            ToggleButton:
                id: weapon_1
                text: "sabre"
                state: "down" if root.weapon == 1 else "normal"
                font_size: 80
                font_name:"agencyb"
                group: "weapon"
                color: app.color_weapon_dis if root.weapon != 1 else app.color_weapon_ena
                background_color: [0, 0, 0, 1]
                on_press: app.set_weapon(1)

        Carousel:
            id: left_score_carousel
            direction: "top"
            loop: True
            size: 420, 480
            size_hint: None, None
            pos: 20, 0
            min_move: 0.05

            old_index: 0
            on_index: app.carousel_handler(0, self.old_index, self.index, [3, 2]); self.old_index = self.index

            Button:
                on_press: app.send_handler(2)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(2)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(2)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

        Label:
            id: score_l_l
            text: root.score_l_l
            font_size: 480
            font_name:"agencyb"
            size: 200, 480
            size_hint: None, None
            pos: 20, 0
            color: app.color_left_score

        Label:
            id: score_l_r
            text: root.score_l_r
            font_size: 480
            font_name:"agencyb"
            size: 220, 480
            size_hint: None, None
            pos: 220, 0
            color: app.color_left_score

        Carousel:
            id: right_score_carousel
            direction: "top"
            loop: True
            size: 420, 480
            size_hint: None, None
            pos: 1480, 0
            min_move: 0.05

            old_index: 0
            on_index: app.carousel_handler(0, self.old_index, self.index, [15, 9]); self.old_index = self.index

            Button:
                on_press: app.send_handler(9)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(9)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(9)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

        Label:
            id: score_r_l
            text: root.score_r_l
            font_size: 480
            font_name:"agencyb"
            size: 200, 480
            size_hint: None, None
            pos: 1480, 0
            color: app.color_right_score

        Label:
            id: score_r_r
            text: root.score_r_r
            font_size: 480
            font_name:"agencyb"
            size: 200, 480
            size_hint: None, None
            pos: 1700, 0
            color: app.color_right_score

        Carousel:
            id: timer_carousel
            direction: "top"
            loop: True
            size: 550, 300
            size_hint: None, None
            pos: 530 + 200 - 30, 140
            min_move: 0.05

            old_index: 0
            on_index: app.carousel_handler(0, self.old_index, self.index, [6, 14]); self.old_index = self.index

            Button:
                on_press: app.send_handler(13)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(13)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(13)
                background_color: root.color_invis
                background_down: ""
                background_normal: ""

        Label:
            id: timer_min
            text: root.timer_0
            font_size: 360
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 0 - 30, 140
            color: root.color_timer

        Label:
            id: timer_dot
            text: root.timer_1 if root.timer_running == 0 or root.current_time - root.flash_timer < 0.5 else " "
            font_size: 360
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 1 - 40 - 10, 140
            color: root.color_timer

        Label:
            id: timer_dec
            text: root.timer_2
            font_size: 360
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 2 - 80 + 10, 140
            color: root.color_timer

        Label:
            id: timer_sec
            text: root.timer_3
            font_size: 360
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 3 - 80 + 30, 140
            color: root.color_timer

        Label:
            id: timer_text
            text: root.timer_text
            font_size: 300
            font_name:"agencyb"
            size: 600, 300
            size_hint: None, None
            pos: 730, 140
            color: root.color_timer

        Label:
            id: passive
            size: root.passive_size * 2, 0 if root.passive_time > 50 and root.passive_time < 60 and root.current_time - root.flash_timer > 0.5 and root.timer_running == 1 else -32
            size_hint: None, None
            pos: 960 - root.passive_size, 480

            canvas:
                Color:
                    rgba: root.color_passive
                Rectangle:
                    pos: self.pos
                    size: self.size

        Button:
            id: period
            text: str(root.period)
            font_size: 200
            font_name:"agencyb"
            size: 120, 200
            size_hint: None, None
            pos: 580, 100
            color: app.color_period

            on_press: app.send_handler(8)

            background_color: root.color_invis
            background_down: ""
            background_normal: ""

        Label:
            id: passive_counter_2_1
            text: root.passive_coun[0] if root.time_updated or root.timer_running == 0 else self.text
            font_size: 100
            font_name:"agencyb"
            size: 60, 200
            size_hint: None, None
            pos: 585, 285
            color: app.color_passive_white if root.weapon != 1 else app.color_passive_inact

            background_color: root.color_invis
            background_down: ""
            background_normal: ""

        Label:
            id: passive_counter_2_2
            text: root.passive_coun[1] if root.time_updated or root.timer_running == 0 else self.text
            font_size: 100
            font_name:"agencyb"
            size: 60, 200
            size_hint: None, None
            pos: 635, 285
            color: app.color_passive_white if root.weapon != 1 else app.color_passive_inact

            background_color: root.color_invis
            background_down: ""
            background_normal: ""

        Label:
            id: warning_top_l
            text: "penalty"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if root.warning_l >= 2 else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 460, 250

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_red_dis if root.warning_l < 2 else app.color_warn_red_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        Label:
            id: warning_bot_l
            text: "caution"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if root.warning_l >= 1 else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 460, 190

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_yel_dis if root.warning_l < 1 else app.color_warn_yel_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        Button:
            id: left_warning_button
            size: 100, 120
            size_hint: None, None
            pos: 460, 190

            on_press: app.send_handler(4)

            background_color: root.color_invis
            background_down: ""
            background_normal: ""

        Label:
            id: warning_top_r
            text: "penalty"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if root.warning_r >= 2 else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 1360, 250

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_red_dis if root.warning_r < 2 else app.color_warn_red_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        Label:
            id: warning_bot_r
            text: "caution"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if root.warning_r >= 1 else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 1360, 190

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_yel_dis if root.warning_r < 1 else app.color_warn_yel_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        Button:
            id: right_warning_button
            size: 100, 120
            size_hint: None, None
            pos: 1360, 190

            on_press: app.send_handler(11)

            background_color: root.color_invis
            background_down: ""
            background_normal: ""

        Label:
            id: priority_l_cap
            text: "P"
            font_size: 120
            font_name:"agencyb"
            size: 100, 100
            size_hint: None, None
            pos: 460 - 27 - 8, 80
            color: app.color_left_p_ena if root.priority == -1 else app.color_left_p_dis

        Label:
            id: priority_l_word
            text: "priority"
            font_size: 36
            font_name:"agencyb"
            size: 100, 100
            size_hint: None, None
            pos: 460 + 27 - 16, 80 - 27
            color: app.color_warn_text_ena if root.priority == -1 else app.color_warn_text_dis

        Label:
            id: priority_r_cap
            text: "P"
            font_size: 120
            font_name:"agencyb"
            size: 100, 100
            size_hint: None, None
            pos: 1360 - 27 - 8, 80
            color: app.color_right_p_ena if root.priority == +1 else app.color_right_p_dis

        Label:
            id: priority_r_word
            text: "priority"
            font_size: 36
            font_name:"agencyb"
            size: 100, 100
            size_hint: None, None
            pos: 1360 + 27 - 16, 80 - 27
            color: app.color_warn_text_ena if root.priority == +1 else app.color_warn_text_dis

        ToggleButton:
            id: passive_1
            text: "Pcard"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if self.state == "down" else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 460, 380
            on_press: app.passive_stop_card(self.state)
            disabled: root.timer_running == 1

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_red_dis if self.state == "normal" else app.color_warn_red_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        ToggleButton:
            id: passive_2
            text: "Pcard"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if self.state == "down" else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 460, 320
            on_press: app.passive_stop_card(self.state)
            disabled: root.timer_running == 1

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_yel_dis if self.state == "normal" else app.color_warn_yel_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        ToggleButton:
            id: passive_3
            text: "Pcard"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if self.state == "down" else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 1360, 380
            on_press: app.passive_stop_card(self.state)
            disabled: root.timer_running == 1

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_red_dis if self.state == "normal" else app.color_warn_red_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        ToggleButton:
            id: passive_4
            text: "Pcard"
            font_size: 30
            font_name:"agencyb"
            color: app.color_warn_text_ena if self.state == "down" else app.color_warn_text_dis
            size: 100, 40
            size_hint: None, None
            pos: 1360, 320
            on_press: app.passive_stop_card(self.state)
            disabled: root.timer_running == 1

            background_color: root.color_invis
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

            canvas.before:
                Color:
                    rgba: app.color_warn_yel_dis if self.state == "normal" else app.color_warn_yel_ena
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [app.card_radius,]

        Label:
            id: record_indicator
            size: 32, 32
            size_hint: None, None
            pos: 1920 - 40, 480 - 40

            canvas:
                Color:
                    rgba: app.color_rec if root.recording else app.color_black
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: self.size

    FloatLayout:
        BoxLayout:
            orientation: "vertical"
            size: 480, 480
            size_hint: None, None

            ToggleButton:
                id: settings_system
                group: "settings"
                text: "System"
                font_size: 60
                font_name:"agencyb"

            ToggleButton:
                id: settings_network
                group: "settings"
                text: "Network"
                font_size: 60
                font_name:"agencyb"

            ToggleButton:
                id: settings_remote
                group: "settings"
                text: "Remote"
                font_size: 60
                font_name:"agencyb"
            
            ToggleButton:
                id: settings_update
                group: "settings"
                text: "Update"
                font_size: 60
                font_name:"agencyb"

        RelativeLayout:
            pos: (480, 0) if settings_system.state == "down" else (480, 480)
            
            Button:
                size: 360, 360
                size_hint: None, None
                pos: (1940 - 480) / 2 - 180, 60
                background_normal: "assets/poweroff_button.png"
                background_down: "assets/poweroff_button.png"
                on_press: app.system_poweroff()
            
            #Button:
            #    text: "Reboot"
            #    on_press: app.system_reboot()
        
        RelativeLayout:
            pos: (480, 0) if settings_network.state == "down" else (480, 480)
            
            Label:
                pos: 0, 380
                size: 720, 120
                size_hint: None, None
                text: "Wired"
                font_size: 60
                font_name:"agencyb"
            
            Label:
                pos: 0, 300
                size: 720, 120
                size_hint: None, None
                text: root.wired_ip
                font_size: 40
                font_name:"agencyb"
            
            Label:
                pos: 720, 380
                size: 720, 120
                size_hint: None, None
                text: "Wireless"
                font_size: 60
                font_name:"agencyb"
            
            Label:
                pos: 720, 300
                size: 720, 120
                size_hint: None, None
                text: root.wireless_ip
                font_size: 40
                font_name:"agencyb"

            ScrollView:
                pos: 720, 240
                size: 720, 240
                size_hint: None, None
                pos: 0, 0
                do_scroll_x: False
                do_scroll_y: True

                GridLayout:
                    id: wifi_list
                    size_hint: None, None
                    height: self.minimum_height
                    cols: 1
        
        RelativeLayout:
            pos: (480, 0) if settings_remote.state == "down" else (480, 480)
            Button:
                id: sync_remote
                pos: 480, 0
                size: 480, 480
                size_hint: None, None
                font_size: 40
                font_name:"agencyb"
                text: "Sync new remote"
                sync_state: "no_sync"
                on_press: app.sync_new_remote(self)
        
        RelativeLayout:
            pos: (480, 0) if settings_update.state == "down" else (480, 480)

            Button:
                id: update_btn
                pos: 480, 0
                size: 480, 480
                size_hint: None, None
                font_size: 40
                font_name:"agencyb"
                text: "Check for updates"
                update_state: "no_update"
                on_press: app.update(self)
        #    
        #    Label:
        #        pos: 480, 360
        #        size: 720, 120
        #        size_hint: None, None
        #        text: "Wired"
        #        font_size: 60
        #        font_name:"agencyb"
        #    
        #    Label:
        #        pos: 480, 240
        #        size: 720, 120
        #        size_hint: None, None
        #        text: root.wired_ip
        #        font_size: 40
        #        font_name:"agencyb"
        #    
        #    Label:
        #        pos: 1200, 360
        #        size: 720, 120
        #        size_hint: None, None
        #        text: "Wireless"
        #        font_size: 60
        #        font_name:"agencyb"
        #    
        #    Label:
        #        pos: 1200, 240
        #        size: 720, 120
        #        size_hint: None, None
        #        text: root.wireless_ip
        #        font_size: 40
        #        font_name:"agencyb"
        
        #FloatLayout:
        #    pos: (480, 0) if settings_remote.state == "down" else (480, 480)
        #
        #    Button:
        #        pos: 480, 360
        #        size: 720, 120
        #        size_hint: None, None
        #        font_size: 60
        #        font_name:"agencyb"
        #        text: "Reboot"
            #    on_press: app.system_reboot()

            #Label:
            #    id: tab_2_content
            #    text: root.ip
            #BoxLayout:
            #    id: tab_3_content
            #    Button:
            #        text: "sync hardware"
            #        on_press: app.write_address()

    FloatLayout:
        Video:
            id: video_player
            size: 640, 480
            size_hint: None, None
            pos: 1920 - 640, 0
            state: "play" if root.video_playing else "pause"

        BoxLayout:
            id: player_controls
            orientation: "vertical"
            size: 120, 480
            size_hint: None, None
            pos: 1920 - 640 - 120, 0

            #Button:
            #    id: next_video
            #    size: 120, 120
            #    text: "next"
            #    font_size: 80
            #    font_name:"agencyb"
            #    background_color: [1, 0, 0, 1]
            #    on_press: app.next_video()

            Button:
                id: play_pause_video
                size: 120, 120
                size_hint: None, None
                text: "play/pause"
                font_size: 80
                font_name:"agencyb"
                background_color: [0, 1, 0, 1]
                on_press: app.play_pause_video()

            #Button:
            #    id: previous_video
            #    text: "previous"
            #    font_size: 80
            #    font_name:"agencyb"
            #    background_color: [0, 0, 1, 1]
            #    on_press: app.previous_video()

            #Button:
            #    id: delete_video
            #    text: "delete"
            #    font_size: 80
            #    font_name:"agencyb"
            #    background_color: [0, 1, 1, 1]
            #    on_press: app.delete_video()

        ScrollView:
            size: 400, 480
            size_hint: None, None
            pos: 0, 0
            do_scroll_x: False
            do_scroll_y: True

            GridLayout:
                id: video_list
                size_hint: None, None
                height: self.minimum_height
                cols: 1
    Label:
        id: debug_info
        text: root.debug
        font_size: 80
