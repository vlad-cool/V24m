#:kivy 2.1.0

Carousel:
    loop: True
    
    weapon: 0
    weapon_connection_type: 0
    
    video_timer: 0

    score_l_l: "0"
    score_l_r: " "
    score_r_l: " "
    score_r_r: "0"

    timer_0: "0"
    timer_1: ":"
    timer_2: "0"
    timer_3: "0"

    timer_text: ""

    timer_running: 0

    period: 1
    priority: 0
    warning_l: 0
    warning_r: 0

    passive_timer: -1
    passive_yel_size: 0
    passive_red_size: 0

    flash_timer: 0
    current_time: 0
    
    FloatLayout:
        BoxLayout:
            id: weapon_selector
            orientation: "horizontal"
            size: 800, 100
            size_hint: None, None
            pos: 560, 0

            ToggleButton:
                id: weapon_connection_type
                text: "wls"
                state: "down" if root.weapon_connection_type == 1 else "normal"
                font_size: 60
                font_name:"agencyb"
                color: [0.3, 0.3, 0.3, 1] if self.state == 'normal' else [0.7, 0.7, 0.7, 1]
                background_color: [0, 0, 0, 1] if self.state == 'normal' else [0, 0, 0, 1]
                on_press: app.change_weapon_connection_type()

            ToggleButton:
                id: weapon_2
                text: "fleuret"
                state: "down" if root.weapon == 2 else "normal"
                font_size: 60
                font_name:"agencyb"
                group: "weapon"
                color: [0.3, 0.3, 0.3, 1] if self.state == 'normal' else [0.7, 0.7, 0.7, 1]
                background_color: [0, 0, 0, 1] if self.state == 'normal' else [0, 0, 0, 1]
                on_press: app.set_weapon(2)

            ToggleButton:
                id: weapon_0
                text: "epee"
                state: "down" if root.weapon == 3 else "normal"
                font_size: 60
                font_name:"agencyb"
                group: "weapon"
                color: [0.3, 0.3, 0.3, 1] if self.state == 'normal' else [0.7, 0.7, 0.7, 1]
                background_color: [0, 0, 0, 1] if self.state == 'normal' else [0, 0, 0, 1]
                on_press: app.set_weapon(0)

            ToggleButton:
                id: weapon_1
                text: "sabre"
                state: "down" if root.weapon == 1 else "normal"
                font_size: 60
                font_name:"agencyb"
                group: "weapon"
                color: [0.3, 0.3, 0.3, 1] if self.state == 'normal' else [0.7, 0.7, 0.7, 1]
                background_color: [0, 0, 0, 1] if self.state == 'normal' else [0, 0, 0, 1]
                on_press: app.set_weapon(1)

        Carousel:
            id: left_score_carousel
            direction: "top"
            loop: True
            size: 400, 480
            size_hint: None, None
            pos: 0, 0
            min_move: 0.05

            old_index: 0
            on_index: app.carousel_handler(0, self.old_index, self.index, [3, 2]); self.old_index = self.index

            Button:
                on_press: app.send_handler(2)
                background_color: [0, 0, 0, 1]
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(2)
                background_color: [0, 0, 0, 1]
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(2)
                background_color: [0, 0, 0, 1]
                background_down: ""
                background_normal: ""

        Label:
            id: score_l_l
            text: root.score_l_l
            font_size: 380
            font_name:"agencyb"
            size: 200, 480
            size_hint: None, None
            pos: 0, 0
            color: app.color_left_score

        Label:
            id: score_l_r
            text: root.score_l_r
            font_size: 380
            font_name:"agencyb"
            size: 200, 480
            size_hint: None, None
            pos: 200, 0
            color: app.color_left_score

        Carousel:
            id: right_score_carousel
            direction: "top"
            loop: True
            size: 400, 480
            size_hint: None, None
            pos: 1520, 0
            min_move: 0.05

            old_index: 0
            on_index: app.carousel_handler(0, self.old_index, self.index, [15, 9]); self.old_index = self.index

            Button:
                on_press: app.send_handler(9)
                background_color: [0, 0, 0, 0]
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(9)
                background_color: [0, 0, 0, 0]
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(9)
                background_color: [0, 0, 0, 0]
                background_down: ""
                background_normal: ""

        Label:
            id: score_r_l
            text: root.score_r_l
            font_size: 380
            font_name:"agencyb"
            size: 200, 480
            size_hint: None, None
            pos: 1520, 0
            color: app.color_right_score

        Label:
            id: score_r_r
            text: root.score_r_r
            font_size: 380
            font_name:"agencyb"
            size: 200, 480
            size_hint: None, None
            pos: 1720, 0
            color: app.color_right_score

        Carousel:
            id: timer_carousel
            direction: "top"
            loop: True
            size: 520, 300
            size_hint: None, None
            pos: 530 + 200, 140
            min_move: 0.05

            old_index: 0
            on_index: app.carousel_handler(0, self.old_index, self.index, [6, 14]); self.old_index = self.index

            Button:
                on_press: app.send_handler(13)
                background_color: [0, 0, 0, 0]
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(13)
                background_color: [0, 0, 0, 0]
                background_down: ""
                background_normal: ""

            Button:
                on_press: app.send_handler(13)
                background_color: [0, 0, 0, 0]
                background_down: ""
                background_normal: ""

        Label:
            id: timer_min
            text: root.timer_0
            font_size: 300
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 0, 140
            color: app.color_timer_enabled if root.timer_running else app.color_timer_disabled

        Label:
            id: timer_dot
            #text: ":"
            text: root.timer_1 if root.timer_running == 0 or root.current_time - root.flash_timer < 0.5 else " "
            font_size: 300
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 1 - 40, 140
            color: app.color_timer_enabled if root.timer_running else app.color_timer_disabled
        
        Label:
            id: timer_dec
            text: root.timer_2
            font_size: 300
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 2 - 80, 140
            color: app.color_timer_enabled if root.timer_running else app.color_timer_disabled

        Label:
            id: timer_sec
            text: root.timer_3
            font_size: 300
            font_name:"agencyb"
            size: 150, 300
            size_hint: None, None
            pos: 730 + 150 * 3 - 80, 140
            color: app.color_timer_enabled if root.timer_running else app.color_timer_disabled

        Label:
            id: timer_text
            text: root.timer_text
            font_size: 300
            font_name:"agencyb"
            size: 600, 300
            size_hint: None, None
            pos: 730, 140
            color: app.color_timer_enabled if root.timer_running else app.color_timer_disabled

        Label:
            id: passive_yel
            size: 0 if int(root.current_time - root.passive_timer) > 50 and int(root.current_time - root.passive_timer) < 60 and root.current_time - root.flash_timer > 0.5 else 33, root.passive_yel_size
            #size: 33, root.passive_yel_size if root.timer_running else 0
            size_hint: None, None
            pos: 898, 203
            disabled: True

            canvas:
                Color:
                    rgba: 0.8, 0.8, 0, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Label:
            id: passive_red
            size: 0 if int(root.current_time - root.passive_timer) > 50 and int(root.current_time - root.passive_timer) < 60 and root.current_time - root.flash_timer > 0.5 else 33, root.passive_red_size
            #size: 33, root.passive_red_size if root.timer_running else 0
            size_hint: None, None
            pos: 898, 203 + app.passive_yel_max_size
            disabled: True

            canvas:
                Color:
                    rgba: 0.8, 0, 0, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Button:
            id: period
            text: str(root.period)
            font_size: 200
            font_name:"agencyb"
            size: 120, 200
            size_hint: None, None
            pos: 580, 140
            color: app.color_period

            on_press: app.send_handler(8)

            background_color: [0, 0, 0, 1]
            background_down: ""
            background_normal: ""

        ToggleButton:
            id: warning_top_l
            size: 100, 50
            size_hint: None, None
            pos: 460, 260
            disabled: True if root.warning_l < 2 else False

            background_color: [0.2, 0, 0, 1] if self.disabled else [0.8, 0, 0, 1]
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

        ToggleButton:
            id: warning_bot_l
            size: 100, 50
            size_hint: None, None
            pos: 460, 190
            disabled: True if root.warning_l < 1 else False

            background_color: [0.2, 0.2, 0, 1] if self.disabled else [0.8, 0.8, 0, 1]
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

        Button:
            id: left_warning_button
            size: 100, 120
            size_hint: None, None
            pos: 460, 190

            on_press: app.send_handler(4)

            background_color: [0, 0, 0, 0]
            background_down: ""
            background_normal: ""

        ToggleButton:
            id: warning_top_r
            size: 100, 50
            size_hint: None, None
            pos: 1360, 260
            disabled: True if root.warning_r < 2 else False

            background_color: [0.2, 0, 0, 1] if self.disabled else [0.8, 0, 0, 1]
            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

        ToggleButton:
            id: warning_bot_r
            size: 100, 50
            size_hint: None, None
            pos: 1360, 190
            disabled: True if root.warning_r < 1 else False

            background_color: [0.2, 0.2, 0, 1] if self.disabled else [0.8, 0.8, 0, 1]

            background_down: ""
            background_normal: ""
            background_disabled_down: ""
            background_disabled_normal: ""

        Button:
            id: right_warning_button
            size: 100, 120
            size_hint: None, None
            pos: 1360, 190

            on_press: app.send_handler(11)

            background_color: [0, 0, 0, 0]
            background_down: ""
            background_normal: ""

        Label:
            id: priority_l
            text: "P"
            font_size: 100
            font_name:"agencyb"
            size: 100, 100
            size_hint: None, None
            pos: 460, 330
            color: [0.2, 0, 0, 1] if root.priority != -1 else app.color_left_score

        Label:
            id: priority_r
            text: "P"
            font_size: 100
            font_name:"agencyb"
            size: 100, 100
            size_hint: None, None
            pos: 1360, 330
            color: [0, 0.2, 0, 1] if root.priority != +1 else app.color_right_score

    TabbedPanel:
        TabbedPanelItem:
            text: "Hardware"
            BoxLayout:
                Button:
                    text: "sync hardware"
                    on_press: app.write_address()
        TabbedPanelItem:
            text: "System"
            BoxLayout:
                Button:
                    text: "Reboot"
                    on_press: app.system_reboot()
                Button:
                    text: "Poweroff"
                    on_press: app.system_poweroff()
        TabbedPanelItem:
            text: "Apps"
            BoxLayout:
                Button:
                    text: "TEST"
                    on_press: app.run_app("test")
